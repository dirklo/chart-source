<main class="container">
    <section class="dashboard_header">
        <h1>Dashboard</h1>
        <h2>You are logged in as: <%= current_user.username %></h2>
    </section>
    <section class="dashboard_body">
        <article class="my_arrangements_list">
            <h2>My Arrangements:</h2>
            <br>
            <% @user.owned_arrangements.order(:name).each do |arrangement| %>
                <%= render partial: 'arrangements/arrangement_card', 
                           :locals => { 
                                user: @user, 
                                arrangement: arrangement, 
                                kind: 'arr_list',
                                set_entry: SetEntry.new
                           } 
                %>
            <% end %>
        </article>
        <article class="my_setlists_list">
            <h2>My Setlist:</h2>
                <%= collection_select :setlist, :id, @user.created_setlists.all, :id, :name %>
            <div data-controller="drag" data-drag-url="/set_entries/:id/move" id="setlist_list">
                <% @setlist.set_entries.order(position: :asc).each do |set_entry| %>
                    <%= render partial: 'arrangements/arrangement_card', 
                               :locals => { 
                                    user: @user, 
                                    arrangement: set_entry.arrangement, 
                                    kind: 'setlist_list',
                                    set_entry: set_entry
                               } 
                    %>
                <% end %>
            </div>
            <div id="setlist_add">
                <%= link_to 'New Setlist', new_user_setlist_path(@user), remote: true %>
            </div>
        </article>
    </section>
    <section class="dashboard_footer">
    
    </section>
</main>

<script>
    // $(document).on('click', '.accordion_title', function() {
    //     $(this).parent().next().toggleClass("active")
    // })

    $(document).on('change', "#setlist_id", function(){
        $.ajax({
            url: "/populate_setlist",
            type: "GET",
            data: {setlist_id: $(this).val()}
        })
    });

    $(document).on('click', ".add_to_setlist", function(event){
        if ($("#setlist_list").children().length == 0) {
            position = 0
        } else {
            position = $("#setlist_list").children().last().data().id
        }

        $.ajax({
            url: "/set_entries",
            type: "POST",
            data: {
                arrangement_id: $(this).children(".arrangement_id_span").text(),
                setlist_id: $("#setlist_id").val(),
                position: position
            }
        })
    });

    $(document).on('click', ".remove_from_setlist", function(event){
        $.ajax({
            url: "/set_entries",
            type: "DELETE",
            data: {
                set_entry_id: $(this).children('.set_entry_id_span').text()
            }
        })
    });
</script>